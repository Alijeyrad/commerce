{% extends "auctions/layout.html" %}

{% block title %}
  {{listing.title}}
{% endblock title %}

{% block body %}
  <div class="container listing">
    <div class="image">
        <img src="{{listing.image_url}}" alt="{{listing.title}}">
    </div>
    <div class="info">
        <h5>
          {{listing.title}}
        </h5>
        <p>{{listing.description}}</p>
        <p> <strong>starting price: </strong>${{listing.starting_bid}}</p>
        
        {% if listing.active %}
          <p style="color:rgb(5, 91, 5)">This listing is active</p>
          {% else %}
          <p style="color:rgb(147, 6, 6)">This auction is closed</p>
        {% endif %}
          
        
        {% if listing.owner == user and listing.active %}
          <form action="{% url 'close_listing' listing.id %}">
            <button type="submit" class="btn btn-danger">Close this Auction</button>
          </form>
        {% endif %}
          
        <p><strong>category: </strong>{{listing.category}}</p>
        <p><strong>Created by: </strong>{{listing.owner}}</p>
        <p><strong>Created: </strong>{{listing.created_date}}</p>
    </div>
  </div>

  <div class="container bidding">
    
    {% if latest_bid %}
    
      {% if listing.active %}
        <strong>Current Bid: </strong>${{latest_bid.bid}}
        {% else %}
        <strong>Sold for: </strong>${{latest_bid.bid}}
      {% endif %}
      
      
      {% if latest_bid.bidder == user %}
    
        {% if listing.active %}
          <span>by you</span>
          {% else %}
          <span>to you</span>
        {% endif %}
      
        
        {% if listing.active %}
        <span>
          <form class="remove_watchlist" method="post" action="{% url 'remove_watchlist' listing.id %}">
            {% csrf_token %}
            <button type="submit">Remove your bid</button>
          </form>
        </span>
        {% endif %}
          
      {% else %}
      
          {% if listing.active %}
            <span>by {{latest_bid.bidder}}</span>
            {% else %}
            <span>to {{latest_bid.bidder}}</span>
          {% endif %}
        
      {% endif %}
        
      {% else %}
      
      {% if listing.active %}
        <strong>Current Bid: </strong>No bids yet, be the first to bid.
        {% else %}
        <strong>Sold for: </strong>This item had no bids
      {% endif %}
        
    {% endif %}
      
    
    {% if user.is_authenticated %}
      <form class="bid" action="{% url 'add_bid' listing.id %}" method="post">
        {% csrf_token %}
        <br>
        <input type="number" step="0.1" min=0 name="bid" placeholder="Place your bid" required>
        <button type="submit">Add to Watchlist</button>
      </form>
        {% else %}
        <h2>Log in to bid on this item</h2>
    {% endif %}
      
  </div>
  
  {% if message %}
    <p>{{message}}</p>
  {% endif %}

  <div class="container comments">
    <br>
    {% if user.is_authenticated %}
    <form action="{% url 'comment' listing.id %}" method="post" class="commentForm">
      {% csrf_token %}
      <textarea name="comment" cols="30" rows="3" placeholder="Comment here" required></textarea>
      <button type="submit">Comment</button>
    </form>
      {% else %}
      <h2>Log in to comment</h2>
    {% endif %}

    
    {% for comment in comments %}
      <div class="singleComment">
        <strong>{{comment.writer}}:</strong>
        <span>{{comment.text}}</span>
        <p><small>{{comment.time_added}}</small></p>
      </div>
      {% empty %}
      No comments for this listing
    {% endfor %}
      
  </div>
    

{% endblock body %}
  